apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.labels.app }}-dashboard
  namespace: monitoring
  labels:
    app: {{ .Values.labels.app }}
    service: {{ .Values.labels.service }}
    grafana_dashboard: "1"
spec:
  # The key name here will be the filename inside Grafana
  nodejs-app-dashboard.json: |-
{{- $files := .Files }}
{{- if $files.Exists "dashboards/nodejs-app-dashboard.json" }}
{{ $files.Get "dashboards/nodejs-app-dashboard.json" | indent 4 }}
{{- else }}
    error: "Dashboard file not found at dashboards/nodejs-app-dashboard.json"
{{- end }}